<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nowoczesny Generator Kodów Kreskowych i QR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --background-color: #f8f9fa;
            --card-background: #ffffff;
            --text-color: #212529;
            --border-radius: 12px;
            --box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        h2 {
            color: var(--secondary-color);
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }

        .description {
            color: var(--text-color);
            opacity: 0.8;
            font-size: 1.1rem;
        }

        .card {
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--secondary-color);
        }

        input, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 600px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        button:hover {
            background-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .result-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 2rem;
        }

        .barcode-wrapper {
            background-color: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 1.5rem;
            max-width: 100%;
            overflow: hidden;
        }

        .buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 1.5rem;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            body {
                padding: 1rem;
            }
            
            .card {
                padding: 1.5rem;
            }
        }

        .error {
            color: #e63946;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .settings-toggle {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .settings-toggle:hover {
            text-decoration: underline;
            background: none;
            transform: none;
        }

        .settings-toggle svg {
            margin-right: 0.5rem;
            transition: transform 0.3s;
        }

        .settings-toggle.active svg {
            transform: rotate(90deg);
        }

        .advanced-settings {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .advanced-settings.active {
            max-height: 1000px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 2rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-color);
            opacity: 0.7;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: var(--primary-color);
            opacity: 1;
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .sequence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .sequence-item {
            background-color: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .sequence-item p {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            text-align: center;
            word-break: break-all;
        }

        .print-sheet {
            width: 100%;
            margin-top: 2rem;
            page-break-inside: avoid;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            
            #printContainer, #printContainer * {
                visibility: visible;
            }
            
            #printContainer {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            
            .container, .card {
                box-shadow: none;
                padding: 0;
                margin: 0;
            }
        }

        .label-size-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .label-size-container.active {
            max-height: 1000px;
            margin-top: 1rem;
        }

        .preview-container {
            margin-top: 2rem;
            width: 100%;
            overflow-x: auto;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
        }

        .preview-table th, .preview-table td {
            border: 1px solid #e9ecef;
            padding: 0.75rem;
            text-align: left;
        }

        .preview-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        .label-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 2rem;
        }

        .label {
            border: 1px dashed #ccc;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 150px;
        }
        
        /* Style dla drukarek Zebra */
        @media print {
            body, html {
                margin: 0;
                padding: 0;
                background: white;
            }
            
            .zebra-label {
                page-break-after: always;
                padding: 0;
                margin: 0;
                height: 100vh;
                width: 100%;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                box-sizing: border-box;
            }
            
            .zebra-code {
                max-width: 90%;
            }
            
            .zebra-text {
                margin-top: 10px;
                font-size: 14px;
                font-weight: bold;
                text-align: center;
            }
            
            /* Ukryj wszystkie inne elementy przy drukowaniu */
            header, .card, .tabs, .buttons, .preview-container, .container > *:not(#zebraPrintContainer) {
                display: none !important;
            }
            
            #zebraPrintContainer {
                width: 100%;
                position: absolute;
                top: 0;
                left: 0;
                margin: 0;
                padding: 0;
            }
            
            /* Ukryj URL, datę, nagłówki i stopki podczas drukowania */
            @page {
                size: auto;
                margin: 0mm;
            }
        }

        .radio-group {
            display: flex;
            gap: 1rem;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .radio-group input {
            width: auto;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Nowoczesny Generator Kodów Kreskowych i QR</h1>
            <p class="description">Twórz profesjonalne kody kreskowe i QR w różnych formatach</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="single">Pojedynczy kod</div>
            <div class="tab" data-tab="sequence">Sekwencja kodów</div>
        </div>
        
        <!-- Pojedynczy kod -->
        <div id="singleTab" class="tab-content active">
            <div class="card">
                <form id="barcodeForm">
                    <div class="form-group">
                        <label for="barcodeData">Dane kodu</label>
                        <input type="text" id="barcodeData" placeholder="Wprowadź dane do kodowania" required>
                        <div id="dataError" class="error hidden">Proszę wprowadzić poprawne dane</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="barcodeType">Typ kodu</label>
                        <select id="barcodeType">
                            <option value="CODE128">CODE128 (alfanumeryczny)</option>
                            <option value="EAN13">EAN-13 (13 cyfr)</option>
                            <option value="EAN8">EAN-8 (8 cyfr)</option>
                            <option value="UPC">UPC-A (12 cyfr)</option>
                            <option value="CODE39">CODE39 (alfanumeryczny)</option>
                            <option value="ITF14">ITF-14 (14 cyfr)</option>
                            <option value="MSI">MSI (tylko cyfry)</option>
                            <option value="pharmacode">Pharmacode (tylko cyfry)</option>
                            <option value="QR">Kod QR</option>
                        </select>
                    </div>
                    
                    <button type="button" class="settings-toggle" id="settingsToggle">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                        Ustawienia zaawansowane
                    </button>
                    
                    <div class="advanced-settings" id="advancedSettings">
                        <div id="barcodeSettings">
                            <div class="grid">
                                <div class="form-group">
                                    <label for="lineColor">Kolor kresek</label>
                                    <input type="color" id="lineColor" value="#000000">
                                </div>
                                
                                <div class="form-group">
                                    <label for="backgroundColor">Kolor tła</label>
                                    <input type="color" id="backgroundColor" value="#ffffff">
                                </div>
                                
                                <div class="form-group">
                                    <label for="width">Szerokość (px)</label>
                                    <input type="number" id="width" min="1" max="4" step="0.5" value="2">
                                </div>
                                
                                <div class="form-group">
                                    <label for="height">Wysokość (px)</label>
                                    <input type="number" id="height" min="10" max="150" value="100">
                                </div>
                                
                                <div class="form-group">
                                    <label for="displayValue">Pokaż tekst</label>
                                    <select id="displayValue">
                                        <option value="true">Tak</option>
                                        <option value="false">Nie</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="fontSize">Rozmiar tekstu</label>
                                    <input type="number" id="fontSize" min="8" max="24" value="16">
                                </div>
                            </div>
                        </div>
                        
                        <div id="qrSettings" class="hidden">
                            <div class="grid">
                                <div class="form-group">
                                    <label for="qrSize">Rozmiar QR (px)</label>
                                    <input type="number" id="qrSize" min="100" max="500" value="200">
                                </div>
                                
                                <div class="form-group">
                                    <label for="qrForeground">Kolor QR</label>
                                    <input type="color" id="qrForeground" value="#000000">
                                </div>
                                
                                <div class="form-group">
                                    <label for="qrBackground">Kolor tła QR</label>
                                    <input type="color" id="qrBackground" value="#ffffff">
                                </div>
                                
                                <div class="form-group">
                                    <label for="qrCorrection">Poziom korekcji błędów</label>
                                    <select id="qrCorrection">
                                        <option value="L">Niski (7%)</option>
                                        <option value="M" selected>Średni (15%)</option>
                                        <option value="Q">Wysoki (25%)</option>
                                        <option value="H">Bardzo wysoki (30%)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" id="generateBtn">Generuj kod</button>
                </form>
            </div>
            
            <div id="singleResultContainer" class="result-container hidden">
                <div class="barcode-wrapper">
                    <svg id="barcodeOutput"></svg>
                    <div id="qrOutput"></div>
                </div>
                
                <div class="buttons">
                    <button id="downloadPNG" class="btn-secondary">Pobierz jako PNG</button>
                    <button id="downloadSVG" class="btn-secondary" id="svgButton">Pobierz jako SVG</button>
                    <button id="printBarcode" class="btn-secondary">Drukuj kod</button>
                </div>
            </div>
        </div>
        
        <!-- Sekwencja kodów -->
        <div id="sequenceTab" class="tab-content">
            <div class="card">
                <form id="sequenceForm">
                    <div class="grid-2">
                        <div class="form-group">
                            <label for="startCode">Kod początkowy</label>
                            <input type="text" id="startCode" placeholder="np. EWMAGEXP1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="endCode">Kod końcowy</label>
                            <input type="text" id="endCode" placeholder="np. EWMAGEXP400" required>
                        </div>
                    </div>
                    
                    <div id="sequenceError" class="error hidden">Proszę wprowadzić poprawne kody. Muszą mieć taki sam prefiks i różnić się tylko liczbą.</div>
                    
                    <div class="form-group">
                        <label for="sequenceType">Typ kodu</label>
                        <select id="sequenceType">
                            <option value="CODE128">CODE128 (alfanumeryczny)</option>
                            <option value="CODE39">CODE39 (alfanumeryczny)</option>
                            <option value="QR">Kod QR</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Format wydruku</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="printFormat" value="labels" checked>
                                Etykiety
                            </label>
                            <label>
                                <input type="radio" name="printFormat" value="sheet">
                                Arkusz
                            </label>
                        </div>
                    </div>
                    
                    <div id="labelSizeContainer" class="label-size-container active">
                        <div class="form-group">
                            <label for="labelType">Rozmiar etykiet</label>
                            <select id="labelType">
                                <option value="courier">Etykiety kurierskie (100x150mm)</option>
                                <option value="address">Etykiety adresowe (70x37mm)</option>
                                <option value="small">Małe etykiety (50x30mm)</option>
                                <option value="custom">Własny rozmiar</option>
                            </select>
                        </div>
                        
                        <div id="customSizeContainer" class="hidden">
                            <div class="grid-2">
                                <div class="form-group">
                                    <label for="labelWidth">Szerokość etykiety (mm)</label>
                                    <input type="number" id="labelWidth" min="20" max="300" value="100">
                                </div>
                                
                                <div class="form-group">
                                    <label for="labelHeight">Wysokość etykiety (mm)</label>
                                    <input type="number" id="labelHeight" min="20" max="300" value="150">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" class="settings-toggle" id="sequenceSettingsToggle">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                        Ustawienia zaawansowane
                    </button>
                    
                    <div class="advanced-settings" id="sequenceAdvancedSettings">
                        <div id="sequenceBarcodeSettings">
                            <div class="grid">
                                <div class="form-group">
                                    <label for="seqLineColor">Kolor kresek</label>
                                    <input type="color" id="seqLineColor" value="#000000">
                                </div>
                                
                                <div class="form-group">
                                    <label for="seqWidth">Szerokość (px)</label>
                                    <input type="number" id="seqWidth" min="1" max="4" step="0.5" value="2">
                                </div>
                                
                                <div class="form-group">
                                    <label for="seqHeight">Wysokość (px)</label>
                                    <input type="number" id="seqHeight" min="10" max="150" value="80">
                                </div>
                                
                                <div class="form-group">
                                    <label for="seqDisplayValue">Pokaż tekst</label>
                                    <select id="seqDisplayValue">
                                        <option value="true">Tak</option>
                                        <option value="false">Nie</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div id="sequenceQrSettings" class="hidden">
                            <div class="grid">
                                <div class="form-group">
                                    <label for="seqQrSize">Rozmiar QR (px)</label>
                                    <input type="number" id="seqQrSize" min="80" max="300" value="100">
                                </div>
                                
                                <div class="form-group">
                                    <label for="seqQrForeground">Kolor QR</label>
                                    <input type="color" id="seqQrForeground" value="#000000">
                                </div>
                                
                                <div class="form-group">
                                    <label for="seqQrCorrection">Poziom korekcji błędów</label>
                                    <select id="seqQrCorrection">
                                        <option value="L">Niski (7%)</option>
                                        <option value="M" selected>Średni (15%)</option>
                                        <option value="Q">Wysoki (25%)</option>
                                        <option value="H">Bardzo wysoki (30%)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" id="generateSequenceBtn">Generuj sekwencję kodów</button>
                </form>
            </div>
            
            <div id="sequenceResultContainer" class="hidden">
                <div class="buttons">
                    <button id="downloadExcel" class="btn-secondary">Eksportuj do Excela</button>
                    <button id="printLabels" class="btn-secondary">Drukuj etykiety</button>
                    <button id="printPreview" class="btn-secondary">Podgląd wydruku</button>
                    <button id="downloadPDF" class="btn-secondary">Eksportuj do PDF</button>
                </div>
                
                <div class="preview-container">
                    <h2>Podgląd wygenerowanych kodów:</h2>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>Lp.</th>
                                <th>Kod</th>
                                <th>Podgląd</th>
                            </tr>
                        </thead>
                        <tbody id="previewTableBody">
                            <!-- Tu będą wyświetlane wygenerowane kody -->
                        </tbody>
                    </table>
                </div>
                
                <div id="printContainer" class="hidden">
                    <!-- Tu będą generowane etykiety do wydruku -->
                </div>
                
                <div id="zebraPrintContainer" class="hidden">
                    <!-- Tu będą generowane etykiety do wydruku na drukarce Zebra -->
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementy interfejsu - pojedynczy kod
            const form = document.getElementById('barcodeForm');
            const barcodeData = document.getElementById('barcodeData');
            const barcodeType = document.getElementById('barcodeType');
            const lineColor = document.getElementById('lineColor');
            const backgroundColor = document.getElementById('backgroundColor');
            const width = document.getElementById('width');
            const height = document.getElementById('height');
            const displayValue = document.getElementById('displayValue');
            const fontSize = document.getElementById('fontSize');
            const resultContainer = document.getElementById('singleResultContainer');
            const dataError = document.getElementById('dataError');
            const barcodeOutput = document.getElementById('barcodeOutput');
            const qrOutput = document.getElementById('qrOutput');
            const barcodeSettings = document.getElementById('barcodeSettings');
            const qrSettings = document.getElementById('qrSettings');
            const svgButton = document.getElementById('downloadSVG');
            
            // Elementy interfejsu - sekwencja kodów
            const sequenceForm = document.getElementById('sequenceForm');
            const startCode = document.getElementById('startCode');
            const endCode = document.getElementById('endCode');
            const sequenceError = document.getElementById('sequenceError');
            const sequenceType = document.getElementById('sequenceType');
            const sequenceResultContainer = document.getElementById('sequenceResultContainer');
            const previewTableBody = document.getElementById('previewTableBody');
            const printContainer = document.getElementById('printContainer');
            const sequenceBarcodeSettings = document.getElementById('sequenceBarcodeSettings');
            const sequenceQrSettings = document.getElementById('sequenceQrSettings');
            const labelTypeSelect = document.getElementById('labelType');
            const customSizeContainer = document.getElementById('customSizeContainer');
            const labelSizeContainer = document.getElementById('labelSizeContainer');
            
            // Elementy przełączające ustawienia
            const settingsToggle = document.getElementById('settingsToggle');
            const advancedSettings = document.getElementById('advancedSettings');
            const sequenceSettingsToggle = document.getElementById('sequenceSettingsToggle');
            const sequenceAdvancedSettings = document.getElementById('sequenceAdvancedSettings');
            
            // Obsługa zakładek
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Usuń klasę active ze wszystkich zakładek i treści
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Dodaj klasę active do klikniętej zakładki i jej treści
                    this.classList.add('active');
                    document.getElementById(tabId + 'Tab').classList.add('active');
                });
            });
            
            // Obsługa przycisku ustawień zaawansowanych
            settingsToggle.addEventListener('click', function() {
                advancedSettings.classList.toggle('active');
                settingsToggle.classList.toggle('active');
            });
            
            sequenceSettingsToggle.addEventListener('click', function() {
                sequenceAdvancedSettings.classList.toggle('active');
                sequenceSettingsToggle.classList.toggle('active');
            });
            
            // Przełączanie między typami kodów (barcode/QR)
            barcodeType.addEventListener('change', function() {
                const type = barcodeType.value;
                updateCodeTypeUI(type);
            });
            
            sequenceType.addEventListener('change', function() {
                const type = sequenceType.value;
                updateSequenceCodeTypeUI(type);
            });
            
            // Obsługa formatu wydruku (etykiety/arkusz)
            const printFormatRadios = document.querySelectorAll('input[name="printFormat"]');
            printFormatRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'labels') {
                        labelSizeContainer.classList.add('active');
                    } else {
                        labelSizeContainer.classList.remove('active');
                    }
                });
            });
            
            // Obsługa rozmiaru etykiet
            labelTypeSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customSizeContainer.classList.remove('hidden');
                } else {
                    customSizeContainer.classList.add('hidden');
                }
            });
            
            // Funkcja aktualizująca UI w zależności od typu kodu
            function updateCodeTypeUI(type) {
                // Wyczyść błędy walidacji przy zmianie typu
                dataError.classList.add('hidden');
                
                if (type === 'QR') {
                    barcodeSettings.classList.add('hidden');
                    qrSettings.classList.remove('hidden');
                    svgButton.classList.add('hidden');
                } else {
                    barcodeSettings.classList.remove('hidden');
                    qrSettings.classList.add('hidden');
                    svgButton.classList.remove('hidden');
                    
                    // Ustaw placeholder w zależności od typu kodu
                    switch (type) {
                        case 'EAN13':
                            barcodeData.placeholder = 'Wprowadź 12-13 cyfr';
                            break;
                        case 'EAN8':
                            barcodeData.placeholder = 'Wprowadź 7-8 cyfr';
                            break;
                        case 'UPC':
                            barcodeData.placeholder = 'Wprowadź 11-12 cyfr';
                            break;
                        case 'ITF14':
                            barcodeData.placeholder = 'Wprowadź 14 cyfr';
                            break;
                        case 'MSI':
                        case 'pharmacode':
                            barcodeData.placeholder = 'Wprowadź tylko cyfry';
                            break;
                        default:
                            barcodeData.placeholder = 'Wprowadź dane do kodowania';
                    }
                }
            }
            
            // Funkcja aktualizująca UI sekwencji w zależności od typu kodu
            function updateSequenceCodeTypeUI(type) {
                if (type === 'QR') {
                    sequenceBarcodeSettings.classList.add('hidden');
                    sequenceQrSettings.classList.remove('hidden');
                } else {
                    sequenceBarcodeSettings.classList.remove('hidden');
                    sequenceQrSettings.classList.add('hidden');
                }
            }
            
            // Obsługa formularza pojedynczego kodu
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                generateSingleCode();
            });
            
            // Obsługa formularza sekwencji kodów
            sequenceForm.addEventListener('submit', function(e) {
                e.preventDefault();
                generateSequenceCodes();
            });
            
            // Generowanie pojedynczego kodu
            function generateSingleCode() {
                const data = barcodeData.value;
                const type = barcodeType.value;
                
                // Walidacja danych
                if (!validateData(data, type)) {
                    dataError.classList.remove('hidden');
                    resultContainer.classList.add('hidden');
                    return;
                }
                
                dataError.classList.add('hidden');
                
                // Pokazanie elementu w zależności od typu kodu
                if (type === 'QR') {
                    barcodeOutput.style.display = 'none';
                    qrOutput.style.display = 'block';
                    
                    // Generowanie kodu QR
                    qrOutput.innerHTML = '';
                    const qrSize = parseInt(document.getElementById('qrSize').value);
                    const qrColor = document.getElementById('qrForeground').value;
                    const qrBgColor = document.getElementById('qrBackground').value;
                    const qrCorrection = document.getElementById('qrCorrection').value;
                    
                    try {
                        new QRCode(qrOutput, {
                            text: data,
                            width: qrSize,
                            height: qrSize,
                            colorDark: qrColor,
                            colorLight: qrBgColor,
                            correctLevel: QRCode.CorrectLevel[qrCorrection]
                        });
                        
                        resultContainer.classList.remove('hidden');
                    } catch (error) {
                        dataError.textContent = "Błąd podczas generowania kodu QR: " + error.message;
                        dataError.classList.remove('hidden');
                        resultContainer.classList.add('hidden');
                    }
                } else {
                    barcodeOutput.style.display = 'block';
                    qrOutput.style.display = 'none';
                    
                    // Konfiguracja opcji kodu kreskowego
                    const options = {
                        format: type,
                        lineColor: lineColor.value,
                        background: backgroundColor.value,
                        width: parseFloat(width.value),
                        height: parseInt(height.value),
                        displayValue: displayValue.value === 'true',
                        fontSize: parseInt(fontSize.value)
                    };
                    
                    // Generowanie kodu kreskowego
                    try {
                        JsBarcode("#barcodeOutput", data, options);
                        resultContainer.classList.remove('hidden');
                    } catch (error) {
                        dataError.textContent = "Błąd podczas generowania kodu: " + error.message;
                        dataError.classList.remove('hidden');
                        resultContainer.classList.add('hidden');
                    }
                }
                
                // Przewiń do wyników
                resultContainer.scrollIntoView({ behavior: 'smooth' });
            }
            
            // Generowanie sekwencji kodów
            function generateSequenceCodes() {
                const start = startCode.value;
                const end = endCode.value;
                const type = sequenceType.value;
                
                // Walidacja danych sekwencji
                const sequence = validateAndExtractSequence(start, end);
                
                if (!sequence) {
                    sequenceError.classList.remove('hidden');
                    sequenceResultContainer.classList.add('hidden');
                    return;
                }
                
                sequenceError.classList.add('hidden');
                
                // Generowanie kodów sekwencji
                generateSequencePreview(sequence, type);
                
                // Przewiń do wyników
                sequenceResultContainer.classList.remove('hidden');
                sequenceResultContainer.scrollIntoView({ behavior: 'smooth' });
            }
            
            // Walidacja danych sekwencji
            function validateAndExtractSequence(start, end) {
                if (!start || !end) return null;
                
                // Znajdź część numeryczną na końcu kodu
                const startMatch = start.match(/^(.*?)(\d+)$/);
                const endMatch = end.match(/^(.*?)(\d+)$/);
                
                if (!startMatch || !endMatch) return null;
                
                const startPrefix = startMatch[1];
                const endPrefix = endMatch[1];
                const startNum = parseInt(startMatch[2]);
                const endNum = parseInt(endMatch[2]);
                
                // Sprawdź, czy prefiksy są identyczne
                if (startPrefix !== endPrefix) return null;
                
                // Sprawdź, czy liczby tworzą poprawną sekwencję
                if (startNum >= endNum) return null;
                
                // Limit ilości kodów - zabezpieczenie przed generowaniem zbyt dużej ilości
                if (endNum - startNum > 1000) {
                    sequenceError.textContent = "Maksymalna ilość kodów w sekwencji to 1000.";
                    return null;
                }
                
                // Zwróć obiekt z informacjami o sekwencji
                return {
                    prefix: startPrefix,
                    startNum: startNum,
                    endNum: endNum,
                    digitLength: startMatch[2].length
                };
            }
            
            // Generowanie podglądu sekwencji
            function generateSequencePreview(sequence, type) {
                previewTableBody.innerHTML = '';
                
                // Opcje dla kodów kreskowych
                const seqLineColor = document.getElementById('seqLineColor').value;
                const seqWidth = parseFloat(document.getElementById('seqWidth').value);
                const seqHeight = parseInt(document.getElementById('seqHeight').value);
                const seqDisplayValue = document.getElementById('seqDisplayValue').value === 'true';
                
                // Opcje dla kodów QR
                const seqQrSize = parseInt(document.getElementById('seqQrSize').value);
                const seqQrColor = document.getElementById('seqQrForeground').value;
                const seqQrCorrection = document.getElementById('seqQrCorrection').value;
                
                // Generowanie kodów i dodawanie do tabeli podglądu
                const codes = [];
                const codePromises = [];
                
                for (let i = sequence.startNum; i <= sequence.endNum; i++) {
                    // Formatowanie numeru z wiodącymi zerami, jeśli potrzebne
                    const num = i.toString().padStart(sequence.digitLength, '0');
                    const code = sequence.prefix + num;
                    codes.push(code);
                    
                    // Tworzenie wiersza tabeli
                    const row = document.createElement('tr');
                    
                    // Numer porządkowy
                    const numCell = document.createElement('td');
                    numCell.textContent = i - sequence.startNum + 1;
                    row.appendChild(numCell);
                    
                    // Wartość kodu
                    const codeCell = document.createElement('td');
                    codeCell.textContent = code;
                    row.appendChild(codeCell);
                    
                    // Podgląd kodu
                    const previewCell = document.createElement('td');
                    const previewContainer = document.createElement('div');
                    previewContainer.style.textAlign = 'center';
                    
                    if (type === 'QR') {
                        // Generowanie kodu QR
                        const qrContainer = document.createElement('div');
                        qrContainer.style.display = 'inline-block';
                        previewContainer.appendChild(qrContainer);
                        
                        try {
                            new QRCode(qrContainer, {
                                text: code,
                                width: 80,
                                height: 80,
                                colorDark: seqQrColor,
                                colorLight: "#ffffff",
                                correctLevel: QRCode.CorrectLevel[seqQrCorrection]
                            });
                        } catch (error) {
                            console.error("Błąd generowania QR:", error);
                            qrContainer.textContent = "Błąd QR";
                        }
                    } else {
                        // Generowanie kodu kreskowego
                        const svgElement = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                        previewContainer.appendChild(svgElement);
                        
                        try {
                            JsBarcode(svgElement, code, {
                                format: type,
                                lineColor: seqLineColor,
                                width: seqWidth,
                                height: 40,
                                displayValue: seqDisplayValue,
                                fontSize: 10,
                                margin: 5
                            });
                        } catch (error) {
                            console.error("Błąd generowania kodu kreskowego:", error, code);
                            const errorText = document.createElement('div');
                            errorText.textContent = "Błąd kodu";
                            errorText.style.color = "red";
                            previewContainer.appendChild(errorText);
                        }
                    }
                    
                    previewCell.appendChild(previewContainer);
                    row.appendChild(previewCell);
                    
                    previewTableBody.appendChild(row);
                }
                
                // Przygotuj dane do eksportu Excel
                window.sequenceData = {
                    codes: codes,
                    type: type,
                    options: {
                        lineColor: seqLineColor,
                        width: seqWidth,
                        height: seqHeight,
                        displayValue: seqDisplayValue,
                        qrSize: seqQrSize,
                        qrColor: seqQrColor,
                        qrCorrection: seqQrCorrection
                    }
                };
            }
            
            // Walidacja danych dla pojedynczego kodu
            function validateData(data, type) {
                if (!data) return false;
                
                switch (type) {
                    case 'EAN13':
                        return /^\d{12,13}$/.test(data);
                    case 'EAN8':
                        return /^\d{7,8}$/.test(data);
                    case 'UPC':
                        return /^\d{11,12}$/.test(data);
                    case 'ITF14':
                        return /^\d{14}$/.test(data);
                    case 'MSI':
                    case 'pharmacode':
                        return /^\d+$/.test(data);
                    default:
                        return true;
                }
            }
            
            // Eksport do Excela
            document.getElementById('downloadExcel').addEventListener('click', function() {
                if (!window.sequenceData) return;
                
                const codes = window.sequenceData.codes;
                const type = window.sequenceData.type;
                
                // Tworzenie arkusza Excel
                const ws = XLSX.utils.aoa_to_sheet([
                    ["Lp.", "Kod"],
                    ...codes.map((code, index) => [index + 1, code])
                ]);
                
                // Tworzenie skoroszytu
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Kody");
                
                // Zapis pliku
                XLSX.writeFile(wb, "kody_sekwencja.xlsx");
            });
            
            // Generowanie etykiet do wydruku
            document.getElementById('printPreview').addEventListener('click', function() {
                if (!window.sequenceData) return;
                
                const codes = window.sequenceData.codes;
                const type = window.sequenceData.type;
                const options = window.sequenceData.options;
                
                // Wybierz format wydruku
                const printFormat = document.querySelector('input[name="printFormat"]:checked').value;
                
                // Wyczyść kontenery wydruku
                printContainer.innerHTML = '';
                document.getElementById('zebraPrintContainer').innerHTML = '';
                
                if (printFormat === 'zebra') {
                    // Format dla drukarki Zebra (jedna etykieta na stronę)
                    const zebraContainer = document.getElementById('zebraPrintContainer');
                    zebraContainer.classList.remove('hidden');
                    printContainer.classList.add('hidden');
                    
                    // Generuj etykiety dla drukarki Zebra
                    codes.forEach((code, index) => {
                        const zebraLabel = document.createElement('div');
                        zebraLabel.className = 'zebra-label';
                        
                        // Dodaj kod do etykiety
                        if (type === 'QR') {
                            const qrContainer = document.createElement('div');
                            qrContainer.className = 'zebra-code';
                            zebraLabel.appendChild(qrContainer);
                            
                            try {
                                new QRCode(qrContainer, {
                                    text: code,
                                    width: 200,
                                    height: 200,
                                    colorDark: "#000000",
                                    colorLight: "#ffffff",
                                    correctLevel: QRCode.CorrectLevel.H
                                });
                            } catch (error) {
                                console.error("Błąd generowania QR dla Zebra:", error);
                                qrContainer.textContent = "Błąd QR";
                            }
                        } else {
                            const svgElement = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                            svgElement.className = 'zebra-code';
                            zebraLabel.appendChild(svgElement);
                            
                            try {
                                JsBarcode(svgElement, code, {
                                    format: type,
                                    lineColor: "#000000",
                                    width: 2,
                                    height: 100,
                                    displayValue: true,
                                    fontSize: 16,
                                    margin: 10,
                                    textMargin: 10
                                });
                            } catch (error) {
                                console.error("Błąd generowania kodu dla Zebra:", error);
                                const errorText = document.createElement('div');
                                errorText.textContent = "Błąd kodu";
                                errorText.style.color = "red";
                                zebraLabel.appendChild(errorText);
                            }
                        }
                        
                        // Dodaj tekst kodu
                        const codeText = document.createElement('div');
                        codeText.className = 'zebra-text';
                        codeText.textContent = code;
                        zebraLabel.appendChild(codeText);
                        
                        zebraContainer.appendChild(zebraLabel);
                    });
                    
                    // Otwórz okno wydruku
                    window.setTimeout(function() {
                        window.print();
                    }, 500);
                    
                } else if (printFormat === 'labels') {
                    // Konfiguracja etykiet
                    const labelType = labelTypeSelect.value;
                    let labelWidth, labelHeight;
                    
                    if (labelType === 'custom') {
                        labelWidth = document.getElementById('labelWidth').value;
                        labelHeight = document.getElementById('labelHeight').value;
                    } else {
                        switch (labelType) {
                            case 'courier':
                                labelWidth = 100;
                                labelHeight = 150;
                                break;
                            case 'address':
                                labelWidth = 70;
                                labelHeight = 37;
                                break;
                            case 'small':
                                labelWidth = 50;
                                labelHeight = 30;
                                break;
                        }
                    }
                    
                    // Stwórz kontener dla etykiet
                    const labelGrid = document.createElement('div');
                    labelGrid.className = 'label-grid';
                    labelGrid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(' + labelWidth + 'mm, 1fr))';
                    printContainer.appendChild(labelGrid);
                    
                    // Generuj etykiety
                    codes.forEach((code, index) => {
                        const label = document.createElement('div');
                        label.className = 'label';
                        label.style.width = labelWidth + 'mm';
                        label.style.height = labelHeight + 'mm';
                        
                        // Dodaj kod do etykiety
                        if (type === 'QR') {
                            const qrContainer = document.createElement('div');
                            label.appendChild(qrContainer);
                            
                            try {
                                new QRCode(qrContainer, {
                                    text: code,
                                    width: Math.min(options.qrSize, labelWidth * 0.8),
                                    height: Math.min(options.qrSize, labelHeight * 0.6),
                                    colorDark: options.qrColor,
                                    colorLight: "#ffffff",
                                    correctLevel: QRCode.CorrectLevel[options.qrCorrection]
                                });
                            } catch (error) {
                                console.error("Błąd generowania QR dla etykiety:", error);
                                qrContainer.textContent = "Błąd QR";
                            }
                        } else {
                            const svgElement = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                            label.appendChild(svgElement);
                            
                            try {
                                JsBarcode(svgElement, code, {
                                    format: type,
                                    lineColor: options.lineColor,
                                    width: options.width,
                                    height: Math.min(options.height, labelHeight * 0.5),
                                    displayValue: options.displayValue,
                                    fontSize: 10,
                                    margin: 5
                                });
                            } catch (error) {
                                console.error("Błąd generowania kodu kreskowego dla etykiety:", error);
                                const errorText = document.createElement('div');
                                errorText.textContent = "Błąd kodu";
                                errorText.style.color = "red";
                                label.appendChild(errorText);
                            }
                        }
                        
                        // Dodaj tekst kodu
                        const codeText = document.createElement('p');
                        codeText.textContent = code;
                        codeText.style.fontSize = '10px';
                        codeText.style.margin = '5px 0 0 0';
                        codeText.style.textAlign = 'center';
                        label.appendChild(codeText);
                        
                        labelGrid.appendChild(label);
                    });
                    
                    // Pokaż podgląd wydruku
                    printContainer.classList.remove('hidden');
                    
                    // Otwórz okno wydruku
                    window.setTimeout(function() {
                        window.print();
                    }, 500);
                } else {
                    // Format arkusza
                    const sheetContainer = document.createElement('div');
                    sheetContainer.className = 'print-sheet';
                    printContainer.appendChild(sheetContainer);
                    
                    // Generuj kody na arkuszu
                    codes.forEach((code, index) => {
                        const codeContainer = document.createElement('div');
                        codeContainer.className = 'sequence-item';
                        codeContainer.style.marginBottom = '10px';
                        
                        if (type === 'QR') {
                            const qrContainer = document.createElement('div');
                            codeContainer.appendChild(qrContainer);
                            
                            try {
                                new QRCode(qrContainer, {
                                    text: code,
                                    width: options.qrSize,
                                    height: options.qrSize,
                                    colorDark: options.qrColor,
                                    colorLight: "#ffffff",
                                    correctLevel: QRCode.CorrectLevel[options.qrCorrection]
                                });
                            } catch (error) {
                                console.error("Błąd generowania QR dla arkusza:", error);
                                qrContainer.textContent = "Błąd QR";
                            }
                        } else {
                            const svgElement = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                            codeContainer.appendChild(svgElement);
                            
                            try {
                                JsBarcode(svgElement, code, {
                                    format: type,
                                    lineColor: options.lineColor,
                                    width: options.width,
                                    height: options.height,
                                    displayValue: options.displayValue,
                                    margin: 5
                                });
                            } catch (error) {
                                console.error("Błąd generowania kodu kreskowego dla arkusza:", error, code);
                                const errorText = document.createElement('div');
                                errorText.textContent = "Błąd kodu";
                                errorText.style.color = "red";
                                codeContainer.appendChild(errorText);
                            }
                        }
                        
                        const codeText = document.createElement('p');
                        codeText.textContent = code;
                        codeContainer.appendChild(codeText);
                        
                        sheetContainer.appendChild(codeContainer);
                    });
                    
                    // Pokaż podgląd wydruku
                    printContainer.classList.remove('hidden');
                    
                    // Otwórz okno wydruku
                    window.setTimeout(function() {
                        window.print();
                    }, 500);
                }
            });
            
            // Bezpośredni wydruk etykiet
            document.getElementById('printLabels').addEventListener('click', function() {
                document.getElementById('printPreview').click();
            });
            
            // Eksport do PDF
            document.getElementById('downloadPDF').addEventListener('click', function() {
                if (!window.sequenceData) return;
                
                const codes = window.sequenceData.codes;
                const type = window.sequenceData.type;
                const options = window.sequenceData.options;
                const { jsPDF } = window.jspdf;
                
                // Tworzymy nowy dokument PDF
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                let pageHeight = pdf.internal.pageSize.height;
                let pageWidth = pdf.internal.pageSize.width;
                let margin = 10; // margines w mm
                
                // Generowanie PDF z kodami - każdy kod na osobnej stronie
                const processCode = async (index) => {
                    if (index >= codes.length) {
                        // Wszystkie kody zostały dodane, zapisujemy PDF
                        pdf.save('kody_kreskowe.pdf');
                        return;
                    }
                    
                    const code = codes[index];
                    
                    // Tworzymy tymczasowy element do wygenerowania kodu
                    const tempContainer = document.createElement('div');
                    tempContainer.style.backgroundColor = 'white';
                    tempContainer.style.padding = '20px';
                    tempContainer.style.textAlign = 'center';
                    tempContainer.style.width = '400px';
                    tempContainer.style.margin = '0 auto';
                    document.body.appendChild(tempContainer);
                    
                    if (type === 'QR') {
                        // Generowanie kodu QR
                        const qrContainer = document.createElement('div');
                        tempContainer.appendChild(qrContainer);
                        
                        new QRCode(qrContainer, {
                            text: code,
                            width: 200,
                            height: 200,
                            colorDark: '#000000',
                            colorLight: '#ffffff',
                            correctLevel: QRCode.CorrectLevel.H
                        });
                    } else {
                        // Generowanie kodu kreskowego
                        const svgElement = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                        tempContainer.appendChild(svgElement);
                        
                        JsBarcode(svgElement, code, {
                            format: type,
                            lineColor: '#000000',
                            width: 2,
                            height: 100,
                            displayValue: true,
                            fontSize: 16,
                            margin: 10
                        });
                    }
                    
                    // Dodaj tekst kodu pod kodem
                    const textElement = document.createElement('div');
                    textElement.textContent = code;
                    textElement.style.marginTop = '10px';
                    textElement.style.fontSize = '16px';
                    textElement.style.fontWeight = 'bold';
                    tempContainer.appendChild(textElement);
                    
                    // Konwertuj element na canvas za pomocą html2canvas
                    try {
                        const canvas = await html2canvas(tempContainer);
                        
                        // Wyczyść tymczasowy element
                        document.body.removeChild(tempContainer);
                        
                        // Dodaj nową stronę do PDF (oprócz pierwszej strony)
                        if (index > 0) {
                            pdf.addPage();
                        }
                        
                        // Dodaj obrazek do PDF, wyśrodkowany i z zachowaniem proporcji
                        const imgData = canvas.toDataURL('image/png');
                        const imgWidth = pageWidth - (2 * margin);
                        const imgHeight = (canvas.height * imgWidth) / canvas.width;
                        
                        // Wycentruj obrazek na stronie
                        const x = margin;
                        const y = (pageHeight - imgHeight) / 2;
                        
                        pdf.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);
                        
                        // Przetwórz następny kod
                        processCode(index + 1);
                    } catch (error) {
                        console.error('Błąd tworzenia PDF:', error);
                        alert('Wystąpił błąd podczas tworzenia PDF. Spróbuj ponownie.');
                        
                        // Wyczyść tymczasowy element w przypadku błędu
                        if (document.body.contains(tempContainer)) {
                            document.body.removeChild(tempContainer);
                        }
                    }
                };
                
                // Rozpocznij przetwarzanie od pierwszego kodu
                processCode(0);
            });
            
            // Ustawienie nasłuchiwaczy zdarzeń dla pojedynczego kodu
            document.getElementById('downloadPNG').addEventListener('click', function() {
                downloadBarcode('png');
            });
            
            document.getElementById('downloadSVG').addEventListener('click', function() {
                downloadBarcode('svg');
            });
            
            document.getElementById('printBarcode').addEventListener('click', function() {
                printBarcode();
            });
            
            // Pobieranie pojedynczego kodu
            function downloadBarcode(type) {
                const codeType = barcodeType.value;
                
                if (codeType === 'QR') {
                    // Pobierz kod QR jako PNG
                    const qrImg = qrOutput.querySelector('img');
                    if (!qrImg) return;
                    
                    const link = document.createElement('a');
                    link.href = qrImg.src;
                    link.download = 'qr_code.png';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else {
                    // Pobierz kod kreskowy
                    const svg = document.getElementById('barcodeOutput');
                    const serializer = new XMLSerializer();
                    const svgString = serializer.serializeToString(svg);
                    
                    if (type === 'svg') {
                        // Pobierz jako SVG
                        const blob = new Blob([svgString], {type: 'image/svg+xml'});
                        downloadBlob(blob, 'barcode.svg');
                    } else {
                        // Pobierz jako PNG
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        
                        // Utwórz obrazek z SVG
                        const img = new Image();
                        img.onload = function() {
                            canvas.width = img.width;
                            canvas.height = img.height;
                            context.drawImage(img, 0, 0);
                            
                            // Pobierz jako PNG
                            canvas.toBlob(function(blob) {
                                downloadBlob(blob, 'barcode.png');
                            });
                        };
                        
                        // Konwertuj SVG na format URL data
                        img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgString)));
                    }
                }
            }
            
            // Funkcja pomocnicza do pobierania pliku
            function downloadBlob(blob, filename) {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            // Drukowanie pojedynczego kodu
            function printBarcode() {
                const printWindow = window.open('', '', 'width=800,height=600');
                const codeType = barcodeType.value;
                
                let content;
                if (codeType === 'QR') {
                    const qrImg = qrOutput.querySelector('img');
                    if (!qrImg) return;
                    content = `<img src="${qrImg.src}" style="max-width:100%">`;
                } else {
                    const svg = document.getElementById('barcodeOutput');
                    content = new XMLSerializer().serializeToString(svg);
                }
                
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Drukowanie kodu</title>
                        <style>
                            body {
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                height: 100vh;
                                margin: 0;
                            }
                            .barcode-container {
                                text-align: center;
                            }
                            @media print {
                                .no-print {
                                    display: none;
                                }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="barcode-container">
                            ${content}
                            <p class="no-print">
                                <button onclick="window.print()">Drukuj</button>
                                <button onclick="window.close()">Zamknij</button>
                            </p>
                        </div>
                    </body>
                    </html>
                `);
                
                printWindow.document.close();
            }
            
            // Inicjalizacja UI
            updateCodeTypeUI(barcodeType.value);
            updateSequenceCodeTypeUI(sequenceType.value);
        });
    </script>
</body>
</html>